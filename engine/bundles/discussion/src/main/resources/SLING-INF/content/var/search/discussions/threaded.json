{
  "sakai:query-language": "xpath",
  "sakai:query-template" : "/{path}//element(*)MetaData[@sling:resourceType='sakai/message' and @sakai:type='discussion' and @sakai:marker='{marker}'] order by @{sortOn|sakai:created} {sortOrder|descending}",
  "sling:resourceType": "sakai/search",
  "sakai:batchresultprocessor": "DiscussionThreaded",
  "sakai:title": "Discussion - Threaded view",
  "sakai:shortDescription": "Retrieves a threaded view for a conversation.",
  "sakai:parameters" : [
      "{\"name\" : \"path\", \"description\" : \"The path to look under. It's recommended to use a messagestore\"}",
      "{\"name\" : \"marker\", \"description\" : \"The uniquer marker that identifies a conversation.\"}",
      "{\"name\" : \"sortOn\", \"description\" : \"The name of the property you wish to sort on. This only has any affect if it is used with the sortOrder parameter. Default is sakai:filename\"}",
      "{\"name\" : \"sortOrder\", \"description\" : \"The order you wish to sort in. Either 'ascending' or 'descending'.\"}"      
      ],
  "sakai:description": "This will look for discussion posts part of a conversation under a certain path and represent them in a threaded view.",
  "sakai:response": "Doing a query for discusson posts identified by id26656626 on the my-course-site.<br /> Example: /var/search/discussions/threaded.json?marker=id26656626&path=/sites/my-course-site<br /><pre class=\"json\">{\n    \"query\": \"//sites/my-course-site/store//element(*)MetaData[@sling:resourceType='sakai/message' and @sakai:type='discussion' and @sakai:marker='id26656626'] order by @sakai:created ascending\",\n    \"items\": 25,\n    \"total\": 4,\n    \"results\": [\n        {\n            \"post\": {\n                \"sakai:from\": \"simong\",\n                \"sakai:sendstate\": \"notified\",\n                \"sakai:id\": \"66afb63945a908a150bf436c4e63099670a9a43a\",\n                \"sakai:body\": \"Why do you think sakai 3 will be so much better then sakai 2?\",\n                \"sakai:subject\": \"Why 3akai is awesome.\",\n                \"sling:resourceType\": \"sakai/message\",\n                \"jcr:mixinTypes\": [\n                    \"rep:AccessControllable\"\n                ],\n                \"sakai:messagebox\": \"inbox\",\n                \"sakai:to\": \"s-my-course-site\",\n                \"sakai:initialpost\": \"true\",\n                \"sakai:writeto\": \"/sites/my-course-site/store/\",\n                \"sakai:read\": \"true\",\n                \"sakai:marker\": \"id26656626\",\n                \"jcr:primaryType\": \"nt:unstructured\",\n                \"sakai:type\": \"discussion\",\n                \"sakai:created\": \"2009-12-22 03:25:58+0000\",\n                \"sakai:id\": \"66afb63945a908a150bf436c4e63099670a9a43a\",\n                \"canEdit\": true,\n                \"canDelete\": true,\n                \"profile\": {\n                    \"picture\": \"{\"name\":\"256x256_profilepicture\",\"_name\":\"profilepicture\"}\",\n                    \"email\": [\n                        \"gaeremyncks@gmail.com\"\n                    ],\n                    \"firstName\": [\n                        \"Simon\"\n                    ],\n                    \"sling:resourceType\": \"sakai/user-profile\",\n                    \"jcr:created\": \"2009-11-30T16:23:18\",\n                    \"rep:userId\": [\n                        \"simong\"\n                    ],\n                    \"lastName\": [\n                        \"Gaeremynck\"\n                    ],\n                    \"jcr:primaryType\": \"sling:Folder\",\n                    \"jcr:uuid\": [\n                        \"1295479e-c673-46cc-a63c-52c6d19f4b44\"\n                    ]\n                }\n            },\n            \"replies\": [\n                {\n                    \"post\": {\n                        \"sakai:from\": \"simong\",\n                        \"sakai:sendstate\": \"notified\",\n                        \"sakai:id\": \"d4c1eb7093a0449ac80350237b9fc67a56ed8c39\",\n                        \"sakai:replyon\": \"66afb63945a908a150bf436c4e63099670a9a43a\",\n                        \"sakai:body\": \"Because I can do threaded discussions that is based on a single messaging mechanisme!\",\n                        \"sakai:subject\": \"Re: Why 3akai is awesome.\",\n                        \"sling:resourceType\": \"sakai/message\",\n                        \"jcr:mixinTypes\": [\n                            \"rep:AccessControllable\"\n                        ],\n                        \"sakai:messagebox\": \"inbox\",\n                        \"sakai:to\": \"s-my-course-site\",\n                        \"sakai:read\": \"true\",\n                        \"sakai:marker\": \"id26656626\",\n                        \"sakai:type\": \"discussion\",\n                        \"jcr:primaryType\": \"nt:unstructured\",\n                        \"sakai:created\": \"2009-12-22 03:26:21+0000\",\n                        \"sakai:id\": \"d4c1eb7093a0449ac80350237b9fc67a56ed8c39\",\n                        \"canEdit\": true,\n                        \"canDelete\": true,\n                        \"profile\": {\n                            \"picture\": \"{\"name\":\"256x256_profilepicture\",\"_name\":\"profilepicture\"}\",\n                            \"email\": [\n                                \"gaeremyncks@gmail.com\"\n                            ],\n                            \"firstName\": [\n                                \"Simon\"\n                            ],\n                            \"sling:resourceType\": \"sakai/user-profile\",\n                            \"jcr:created\": \"2009-11-30T16:23:18\",\n                            \"rep:userId\": [\n                                \"simong\"\n                            ],\n                            \"lastName\": [\n                                \"Gaeremynck\"\n                            ],\n                            \"jcr:primaryType\": \"sling:Folder\",\n                            \"jcr:uuid\": [\n                                \"1295479e-c673-46cc-a63c-52c6d19f4b44\"\n                            ]\n                        }\n                    },\n                    \"replies\": [\n                        {\n                            \"post\": {\n                                \"sakai:from\": \"simong\",\n                                \"sakai:sendstate\": \"notified\",\n                                \"sakai:id\": \"e6e5553f2d41ff231f8d89e856068ea2e69e099a\",\n                                \"sakai:replyon\": \"d4c1eb7093a0449ac80350237b9fc67a56ed8c39\",\n                                \"sakai:body\": \"Yes, threaded discussions are like the new minced pies!\",\n                                \"sakai:subject\": \"Re: Re: Why 3akai is awesome.\",\n                                \"sling:resourceType\": \"sakai/message\",\n                                \"jcr:mixinTypes\": [\n                                    \"rep:AccessControllable\"\n                                ],\n                                \"sakai:messagebox\": \"inbox\",\n                                \"sakai:to\": \"s-my-course-site\",\n                                \"sakai:read\": \"true\",\n                                \"sakai:marker\": \"id26656626\",\n                                \"sakai:type\": \"discussion\",\n                                \"jcr:primaryType\": \"nt:unstructured\",\n                                \"sakai:created\": \"2009-12-22 03:26:39+0000\",\n                                \"sakai:id\": \"e6e5553f2d41ff231f8d89e856068ea2e69e099a\",\n                                \"canEdit\": true,\n                                \"canDelete\": true,\n                                \"profile\": {\n                                    \"picture\": \"{\"name\":\"256x256_profilepicture\",\"_name\":\"profilepicture\"}\",\n                                    \"email\": [\n                                        \"gaeremyncks@gmail.com\"\n                                    ],\n                                    \"firstName\": [\n                                        \"Simon\"\n                                    ],\n                                    \"sling:resourceType\": \"sakai/user-profile\",\n                                    \"jcr:created\": \"2009-11-30T16:23:18\",\n                                    \"rep:userId\": [\n                                        \"simong\"\n                                    ],\n                                    \"lastName\": [\n                                        \"Gaeremynck\"\n                                    ],\n                                    \"jcr:primaryType\": \"sling:Folder\",\n                                    \"jcr:uuid\": [\n                                        \"1295479e-c673-46cc-a63c-52c6d19f4b44\"\n                                    ]\n                                }\n                            },\n                            \"replies\": [\n                                \n                            ]\n                        }\n                    ]\n                },\n                {\n                    \"post\": {\n                        \"sakai:from\": \"simong\",\n                        \"sakai:sendstate\": \"notified\",\n                        \"sakai:id\": \"d65479d8ae5449ce953d31b24562fd47f6cacf02\",\n                        \"sakai:replyon\": \"66afb63945a908a150bf436c4e63099670a9a43a\",\n                        \"sakai:body\": \"And clicking a 'Reply' button, writing your post, hit the reply button without refreshing the page is awesome!\",\n                        \"sakai:subject\": \"Re: Why 3akai is awesome.\",\n                        \"sling:resourceType\": \"sakai/message\",\n                        \"jcr:mixinTypes\": [\n                            \"rep:AccessControllable\"\n                        ],\n                        \"sakai:messagebox\": \"inbox\",\n                        \"sakai:to\": \"s-my-course-site\",\n                        \"sakai:read\": \"true\",\n                        \"sakai:marker\": \"id26656626\",\n                        \"sakai:type\": \"discussion\",\n                        \"jcr:primaryType\": \"nt:unstructured\",\n                        \"sakai:created\": \"2009-12-22 03:27:10+0000\",\n                        \"sakai:id\": \"d65479d8ae5449ce953d31b24562fd47f6cacf02\",\n                        \"canEdit\": true,\n                        \"canDelete\": true,\n                        \"profile\": {\n                            \"picture\": \"{\"name\":\"256x256_profilepicture\",\"_name\":\"profilepicture\"}\",\n                            \"email\": [\n                                \"gaeremyncks@gmail.com\"\n                            ],\n                            \"firstName\": [\n                                \"Simon\"\n                            ],\n                            \"sling:resourceType\": \"sakai/user-profile\",\n                            \"jcr:created\": \"2009-11-30T16:23:18\",\n                            \"rep:userId\": [\n                                \"simong\"\n                            ],\n                            \"lastName\": [\n                                \"Gaeremynck\"\n                            ],\n                            \"jcr:primaryType\": \"sling:Folder\",\n                            \"jcr:uuid\": [\n                                \"1295479e-c673-46cc-a63c-52c6d19f4b44\"\n                            ]\n                        }\n                    },\n                    \"replies\": [\n                        \n                    ]\n                }\n            ]\n        }\n    ]\n}</pre>"
}